var UploadInterface=function(e,t){var n=this,i=$(e);this.el=e,this.settings=$.extend({},this.defaults,t),this.key=!1,this.queue=null,this.$queue=null,this.$drop=null,this.$controller=null,this.readyItem=new Array,this.thumnail=new Thumnail(n,{type:n.settings.thumnail.type,size:n.settings.thumnail.size.split("*"),quality:.8,data:{srl:n.settings.thumnail.srl,coords:n.settings.thumnail.coords,url:n.settings.thumnail.url}});var u=function(){n.settings.$queue&&(n.$queue=$('<div class="filesQueue"><figure class="thumnail"></figure><ul></ul></div>'),n.queue=new FilesQueue(n,n.$queue,{}),n.$drop=n.$queue.children("ul"),n.$controller=$('<nav id="queueController"></nav>'),n.settings.$queue.append(n.$queue).append(n.$controller),l(n.$controller),r())},l=function(e){var t="";(n.settings.$insertTarget||n.settings.insertFunc)&&(t+='<button type="button" rg-action="insertContents" class="ui-button btn-small btn-highlight">본문삽입</button>'),t+='<button type="button" rg-action="useThumnail" class="ui-button btn-small">썸네일설정</button>',t+='<button type="button" rg-action="selectAll" class="ui-button btn-small">모두선택</button>',t+='<button type="button" rg-action="deleteSelect" class="ui-button btn-small">선택삭제</button>',t+='<button type="button" rg-action="deleteAll" class="ui-button btn-small">모두삭제</button>',e.append($(t))},s=function(e){var t=["Bytes","KB","MB","GB","TB"];if(0==e)return"0 Byte";var n=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,n),2)+" "+t[n]},a=function(e){var t=e.get(0),n=0;if("selectionStart"in t)n=t.selectionStart;else if("selection"in document){t.focus();var i=document.selection.createRange(),u=document.selection.createRange().text.length;i.moveStart("character",-t.value.length),n=i.text.length-u}return n},r=function(){n.$controller&&n.$controller.children("button").on("click",function(e){switch($(this).attr("rg-action")){case"insertContents":n.insertContent();break;case"useThumnail":n.createThumnail();break;case"selectAll":n.selectAllQueue();break;case"deleteSelect":n.deleteQueue();break;case"deleteAll":n.deleteAllQueue()}}),n.settings.auto&&i.on("change",function(){n.upload()}),$(window).on("keydown",function(e){91==e.which&&(n.key=!0)}),$(window).on("keyup",function(e){n.key=!1}),n.$drop&&(n.$drop.on("dragover",!1),n.$drop.on("dragenter",function(e){e.preventDefault(),e.stopPropagation(),$(this).addClass("drag")}),n.$drop.on("dragleave",function(e){e.preventDefault(),e.stopPropagation(),$(this).removeClass("drag")}),n.$drop.on("drop",function(e){e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length&&(e.preventDefault(),e.stopPropagation(),$(this).removeClass("drag"),n.upload(e.originalEvent.dataTransfer.files))}))},o=function(e){var t=new FileUpload(n,n.settings.uploadAction,n.queue.index[e.key],e.file)},c=function(){i.replaceWith(i=i.clone(!0))},d=function(e){var t=/[.]/.exec(e)?/[^.]+$/.exec(e)[0]:void 0;return/(\.jpg|\.jpeg|\.bmp|\.gif|\.png)$/i.test(e)?"image/"+t:/(\.mp4|\.mov)/gi.test(e)?"video/"+t:/(\.m4a|\.mp3)/gi.test(e)?"audio/"+t:/(\.txt)/i.test(e)?"text/"+t:/(\.pdf|\.zip)/i.test(e)?"application/"+t:null},f=function(e){var t=new Array;for(var n in e)t.push(n);return t};this.upload=function(e){if(n.$queue){var t=e?e:i.get(0).files,u=Object.keys(n.queue.index).length+t.length;if(n.settings.limit&&u>n.settings.limit)alert("파일은 총 "+n.settings.limit+"개까지 업로드할 수 있습니다.");else{for(var l=0;l<t.length;l++)n.readyItem.push({key:n.queue.createQueue(t[l]),file:t[l]});o(n.readyItem[0])}}else alert("not install queue manager")},this.uploadProgress=function(e,t,n){var i=parseInt(e/t*100);n.status="loading",n.element.find("div.body > span.size").text(i+"%"),n.element.find("div.body > span.status").text("Loading"),n.element.find("div.progress span").width(i+"%")},this.uploadComplete=function(e,t){var i=JSON.parse(e);t.status="complete",t.srl=i.sess_srl,t.location=i.loc,t.type="session",t.element.find("div.body > span.size").text(s(t.filesize)),t.element.find("div.body > span.status").text(t.status),"complete"==t.status&&t.element.find("div.progress").delay(200).fadeOut(400),c(),n.refreshAddQueue(),n.readyItem.splice(0,1),n.readyItem.length&&o(n.readyItem[0])},this.uploadError=function(e,t){log(e)},this.pushQueue=function(e){for(var t=0;t<e.length;t++){var i=n.queue.createQueue({name:e[t].filename,size:null,type:d(e[t].filename),loc:e[t].location,srl:e[t].srl,type2:e[t].type,status:e[t].status});n.settings.thumnail.srl==e[t].srl&&n.queue.index[i].element.addClass("thumnail")}e.length&&"session"==e[0].type&&n.refreshAddQueue()},this.insertContent=function(){for(var e="",t=n.queue.getItems(),i=0;i<t.length;i++)e+='<img src="'+n.settings.fileDir+t[i].location+'" alt="" />\n';if(e)if(n.settings.insertFunc)n.settings.insertFunc(e);else if(n.settings.$insertTarget){var u=n.settings.$insertTarget,l=a(u),s=u.val(),r=s.substr(0,l)+e+s.substr(l);u.val(r)}},this.createThumnail=function(){for(var e=null,t=n.queue.getItems(),i=0;i<t.length;i++)if(/^image/i.test(t[i].filetype)){e=t[i];break}if(e||(e=n.queue.getThumnailItem()),!e)for(var u in n.queue.index)if(/^image/i.test(n.queue.index[u].filetype)){e=n.queue.index[u];break}e&&n.thumnail.open(e)},this.selectAllQueue=function(){n.queue.selectAllQueue()},this.deleteQueue=function(){if(confirm("선택한 파일을 삭제하시겠습니까?")){var e=n.$queue.find(">ul>li.on");e.length?n.queue.removeQueue(e):alert("선택한 파일이 없습니다.")}},this.deleteAllQueue=function(){if(confirm("모두 삭제하시겠습니까?")){var e=n.$queue.find(">ul>li");e.length?(n.queue.removeQueue(e),n.queue.clearPreview()):alert("업로드 되어있는 파일이 없습니다.")}},this.refreshAddQueue=function(){var e=$.map(n.queue.index,function(e,t){return"modify"!==e.type?e.srl:void 0}).join(",");n.settings.form.addQueue.value=e},this.thumnailImageCheck=function(){var e=n.queue.$index.children();if(e.filter(".thumnail").length)return!1;var t=!1;return e.each(function(){var e=n.queue.getIndexItem($(this).attr("key"));return/^image/i.test(e.filetype)?(t=!0,!1):void 0}),t&&!n.settings.form.thumnail_image.value?(alert("썸네일 이미지를 만들지 않았습니다."),n.$controller.children("[rg-action=useThumnail]").focus(),!0):!1},u()};UploadInterface.prototype.defaults={uploadAction:null,removeAction:null};
//# sourceMappingURL=./UploadInterface.class.min.js.map