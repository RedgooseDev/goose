var UploadInterface=function(e,t){var n=this,i=$(e);this.el=e,this.settings=$.extend({},this.defaults,t),this.key=!1,this.queue=null,this.$drop=null,this.$queue=$('<div class="filesQueue"><ul></ul></div>'),this.$controller=$('<nav id="queueController"></nav>'),this.readyItem=new Array,this.thumnail=new Thumnail(n,{type:n.settings.thumnail.type,size:n.settings.thumnail.size.split("*"),quality:.8,data:{srl:n.settings.thumnail.srl,coords:n.settings.thumnail.coords,url:n.settings.thumnail.url}});var l=function(){var e="";e+='<button type="button" rg-action="selectAll" class="ui-button btn-small">모두선택</button>',e+='<button type="button" rg-action="deleteSelect" class="ui-button btn-small">선택삭제</button>',e+='<button type="button" rg-action="deleteAll" class="ui-button btn-small">모두삭제</button>',n.$controller.append($(e)).children("button").on("click",function(e){switch($(this).attr("rg-action")){case"selectAll":n.selectAllQueue();break;case"deleteSelect":n.deleteQueue();break;case"deleteAll":n.deleteAllQueue()}})},a=function(){n.settings.auto&&i.on("change",function(){n.upload()}),$(window).on("keydown",function(e){(91==e.which||17==e.which)&&(n.key=!0)}),$(window).on("keyup",function(e){n.key=!1}),n.$drop&&(n.$drop.on("dragover",!1),n.$drop.on("dragenter",function(e){e.preventDefault(),e.stopPropagation(),$(this).addClass("drag")}),n.$drop.on("dragleave",function(e){e.preventDefault(),e.stopPropagation(),$(this).removeClass("drag")}),n.$drop.on("drop",function(e){e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length&&(e.preventDefault(),e.stopPropagation(),$(this).removeClass("drag"),n.upload(e.originalEvent.dataTransfer.files))})),n.queue.$index.dragsort({dragSelector:"li",dragSelectorExclude:"span[contenteditable], button",dragBetween:!0,placeHolderTemplate:'<li class="placeHolder"><div></div></li>',dragEnd:function(){}})},u=function(e){var t=["Bytes","KB","MB","GB","TB"];if(0==e)return"0 Byte";var n=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,n),2)+" "+t[n]},s=function(e){var t=new FileUpload(n,n.settings.uploadAction,n.queue.index[e.key],e.file)},r=function(){i.replaceWith(i=i.clone(!0))};this.getFileType=function(e){var t=/[.]/.exec(e)?/[^.]+$/.exec(e)[0]:void 0;return/(\.jpg|\.jpeg|\.bmp|\.gif|\.png)$/i.test(e)?"image/"+t:/(\.mp4|\.mov)/gi.test(e)?"video/"+t:/(\.m4a|\.mp3)/gi.test(e)?"audio/"+t:/(\.txt)/i.test(e)?"text/"+t:/(\.pdf|\.zip|\.psd)/i.test(e)?"application/"+t:null},this.upload=function(e){if(n.$queue){var t=e?e:i.get(0).files,l=Object.keys(n.queue.index).length+t.length;if(n.settings.limit&&l>n.settings.limit)alert("파일은 총 "+n.settings.limit+"개까지 업로드할 수 있습니다.");else{for(var a=0;a<t.length;a++)n.readyItem.push({key:n.queue.createQueue(t[a]),file:t[a]});n.readyItem.length&&s(n.readyItem[0])}}else alert("not install queue manager")},this.uploadProgress=function(e,t,n){var i=parseInt(e/t*100);n.status="loading",n.element.find("span.size").text(i+"%"),n.element.find("span.status").text("Loading"),n.element.find("div.progress span").width(i+"%")},this.uploadComplete=function(e,t){var i=JSON.parse(e);t.status="complete",t.srl=i.sess_srl,t.location=i.loc,t.type="session",t.element.find("span.size").text(u(t.filesize)),t.element.find("span.status").text(t.status),"complete"==t.status&&t.element.find("div.progress").delay(200).fadeOut(400),/^image/i.test(t.filetype)&&t.element.find("figure").html('<img src="'+n.settings.fileDir+i.loc+'" alt="" />'),r(),n.refreshAddQueue(),n.readyItem.splice(0,1),n.readyItem.length&&s(n.readyItem[0])},this.uploadError=function(e,t){log(e)},this.pushQueue=function(e){for(var t=0;t<e.length;t++){var i=n.queue.createQueue({name:e[t].filename,size:null,type:n.getFileType(e[t].filename),loc:e[t].location,srl:e[t].srl,type2:e[t].type,status:e[t].status,form:e[t].form});n.thumnail.data.srl==e[t].srl&&n.queue.index[i].element.addClass("thumnail")}e.length&&"session"==e[0].type&&n.refreshAddQueue()},this.selectAllQueue=function(){n.queue.selectAllQueue()},this.deleteQueue=function(){if(confirm("선택한 파일을 삭제하시겠습니까?")){var e=n.$queue.find(">ul>li.on");e.length?n.queue.removeQueue(e):alert("선택한 파일이 없습니다.")}},this.deleteAllQueue=function(){if(confirm("모두 삭제하시겠습니까?")){var e=n.$queue.find("> ul > li");e.length?n.queue.removeQueue(e):alert("업로드 되어있는 파일이 없습니다.")}},this.refreshAddQueue=function(){var e=$.map(n.queue.index,function(e,t){return"modify"!==e.type?e.srl:void 0}).join(",");n.settings.form.addQueue.value=e},this.thumnailImageCheck=function(){var e=n.queue.$index.children();if(e.filter(".thumnail").length)return!1;var t=!1;return e.each(function(){var e=n.queue.getIndexItem($(this).attr("key"));return/^image/i.test(e.filetype)?(t=!0,!1):void 0}),t&&!n.settings.form.thumnail_image.value?(alert("썸네일 이미지를 만들지 않았습니다."),n.queue.$index.find("[rg-action=thumnail]").eq(0).focus(),!0):!1},this.exportSlideJSON=function(){var e=new Array;return n.queue.$index.children().each(function(){var t=n.queue.index[$(this).attr("key")],i={filename:t.filename,location:t.location,status:"uploaded",type:"modify",form:new Array};$(this).find("div.form > p").each(function(){var e={key:$(this).children("strong").text(),value:$(this).children("span").text()};i.form.push(e)}),e.push(i)}),encodeURIComponent(JSON.stringify(e))},n.settings.$manager&&(n.queue=new FilesQueue(n,n.$queue,{}),n.$drop=n.$queue.children("ul"),n.settings.$manager.append(n.$queue).append(n.$controller),l(),a(),n.ready=!0)};UploadInterface.prototype.defaults={uploadAction:null,removeAction:null};
//# sourceMappingURL=./UploadInterface.class.min.js.map