var objectToArray=function(obj){var result=[];for(var o in obj){result.push(obj[o])}return result};var getLastItem=function(arr){return arr[arr.length-1]};var setArrayItem=function(src,out,key_target,key_child){for(var i=0;i<src.length;i++){if(src[i][key_target]){out.push(src[i][key_target])}if(src[i][key_child]){setArrayItem(src[i][key_child],out,key_target,key_child)}}};function Navigation(url){var self=this;this.data=null;this.page=null;this.$sideNavigation=$("#comp-side-navigation");this.$topNavigation=$("#comp-top-navigation");this.CompTop=React.createClass({displayName:"CompTop",getInitialState:function(){return{navData:null}},componentDidMount:function(){var top=this;$.get(this.props.sourceUrl,function(data){self.data=data;top.setState({navData:objectToArray(data)});$(window).trigger("hashchange")})},render:function(){return React.createElement("nav",{className:"lay-top-navigation"},React.createElement(self.CompTopList,{data:this.state.navData,ref:"list"}))}});this.CompTopList=React.createClass({displayName:"CompTopList",prev:null,updateSelected:function(name){if(this.refs[name]){if(this.prev)this.prev.className="";this.refs[name].getDOMNode().className="active";this.prev=this.refs[name].getDOMNode()}},render:function(){if(!this.props.data)return React.createElement("ul",null);var top=this;var items=this.props.data.map(function(data){return React.createElement("li",{key:data.name,ref:data.name},React.createElement("a",{href:data.url,target:data.target},data.name))});return React.createElement("ul",null,items)}});this.CompSide=React.createClass({displayName:"CompSide",getInitialState:function(){return{items:null}},update:function(obj){this.setState({items:obj})},componentDidMount:function(){},render:function(){return React.createElement("nav",{className:"lay-side-navigation"},React.createElement("h1",null,self.page),React.createElement(self.CompSideList,{data:this.state.items,ref:"list"}))}});this.CompSideList=React.createClass({displayName:"CompSideList",$prev:null,updateSelected:function(name){if(this.$prev){this.$prev.removeClass("active");this.$prev.parent().parent().filter("[data-ref]").removeClass("active");this.$prev=null}this.$prev=$(this.getDOMNode()).find("[data-ref="+name+"]");this.$prev.parent().parent().filter("[data-ref]").addClass("active");if(this.$prev){this.$prev.addClass("active")}},render:function(){if(!this.props.data)return React.createElement("ul",null);var items=this.props.data.map(function(data){return React.createElement("li",{"data-ref":data.id},React.createElement("a",{href:"#"+data.url},data.name),data.child?React.createElement(self.CompSideList,{data:data.child}):null)});return React.createElement("ul",null,items)}});$(window).on("hashchange.goose",function(){var params=location.hash?location.hash.replace(/^#/gi,"").split("/"):["Introduce"];if(self.data[params[0]]&&params[0]!==self.page){var item=self.data[params[0]];var children=null;self.page=params[0];if(item["child"]){children=item["child"]}var url="./pages/"+self.page+".html";$("#contents").load(url,function(res,state,req){if(state=="error"){log(state+": "+req.statusText)}else{var $contentsGroup=$(this).find("[data-content-group]");if($contentsGroup.length){children=[];$contentsGroup.children("section[id]").each(function(){var url=self.page+"/"+$(this).attr("id");var item={name:$(this).children("h1").text(),id:$(this).attr("id"),url:url};var child=[];$(this).children("section[id]").each(function(){child.push({name:$(this).children("h1").text(),id:$(this).attr("id"),url:self.page+"/"+$(this).attr("id")})});if(child.length){item.child=child}children.push(item)});contents.setSectionTree(children)}self.top.refs.list.updateSelected(self.page);self.side.update(children);if(getLastItem(params)){contents.gotoScroll(getLastItem(params))}}contents.firstTime=false})}else if(getLastItem(params)){contents.gotoScroll(getLastItem(params));contents.firstTime=false}});var current=null;var list=null;$(window).on("scroll.sideNavigation",function(){var st=$(this).scrollTop();var ot=self.$sideNavigation.offset().top;if(ot>st){self.$sideNavigation.removeClass("fixed")}else{self.$sideNavigation.addClass("fixed")}current=$(contents.sectionTree).map(function(o){if($(this).offset().top-$(window).scrollTop()<10){return this}});current=$(current).eq(current.length-1);if(current&&current.length){self.side.refs.list.updateSelected(current.attr("id"))}});if(url){this.top=React.render(React.createElement(this.CompTop,{sourceUrl:url}),this.$topNavigation.get(0));this.side=React.render(React.createElement(this.CompSide,{key:"side"}),this.$sideNavigation.get(0))}}function Contents(){var self=this;this.firstTime=true;this.sectionTree=null;this.setSectionTree=function(data){var arr=[];setArrayItem(data,arr,"id","child");self.sectionTree=arr.map(function(o){if($("#"+o).length){return $("#"+o)[0]}})};this.gotoScroll=function(target){var speed=0;if(target&&$("#"+target).length){speed=!this.firstTime?400:0;if(this.firstTime){imagesLoaded("#contents",function(){$("html, body").scrollTop($("#"+target).offset().top)})}else{this.firstTime=this.firstTime?false:this.firstTime;$("html, body").animate({scrollTop:$("#"+target).offset().top},400)}}}}var navigation=new Navigation("./data/navigation.json");var contents=new Contents;