<?php
if (!defined('__GOOSE__')) exit();

$totalNest = Spawn::count( array('table' => Spawn::getTableName($this->name)) );
?>

<section>
	<!-- headding -->
	<div class="ui-headding">
		<h1><a href="<?=__GOOSE_ROOT__?>nest/index/">Nests</a></h1>
	</div>
	<!-- // headding -->

	<!-- app list -->
	<nav class="nav-category">
		<ul>
			<li<?=(!$app_srl)?" class='active'":""?>>
				<a href="<?=__GOOSE_ROOT__?>nest/index/">All<em><?=$repo['totalNest']?></em></a>
			</li>
			<?php
			foreach($repo['app'] as $k=>$v)
			{
				$url = __GOOSE_ROOT__.'nest/index/'.$v['srl'].'/';
				$active = ($app_srl == $v['srl']) ? " class='active'" : "";
				echo "<li$active><a href='$url'>$v[name]<em>$v[countNest]</em></a></li>";
			}
			?>
		</ul>
	</nav>
	<!-- // app list -->

	<!-- nests list -->
	<ul class="idx-document list">
		<?php
		if (count($repo['nest']))
		{
			foreach ($repo['nest'] as $k=>$v)
			{
				$url = __GOOSE_ROOT__.'article/index/'.$v['srl'].'/';

				// category
				$categoryCount = $categoryBtn = '';
				if ($v['json']['useCategory'] == 1)
				{
					$categoryCount = "<span><b>Category</b>$v[countCategory]</span>";
					$categoryBtn = '<a href="'.__GOOSE_ROOT__.'category/index/'.$v['srl'].'/">분류설정</a>';
				}

				// app name
				$appName = ($v['appName']) ? "<em class=\"txt-brk-type\">$v[appName]</em> " : "";
		?>
				<li>
					<div class="ui-webzine">
						<figure class="thumnail">thumnail</figure>
						<div class="body">
							<a href="<?=$url?>">
								<strong class="hd"><?=$appName?><?=$v['name']?><em class="txt-brk-cnt"><?=$v['countArticle']?></em></strong>
							</a>
							<div class="inf">
								<span><b>ID</b><?=$v['id']?></span>
								<span><b>Date</b><?=Util::convertDate($v['regdate'])?></span>
								<?=$categoryCount?>
								<span><b>Nest skin</b><?=$v['json']['nestSkin']?></span>
								<span><b>Article skin</b><?=$v['json']['articleSkin']?></span>
							</div>
							<nav class="btns">
								<?php
								if ($this->isAdmin)
								{
									echo '<a href="'.__GOOSE_ROOT__.'nest/modify/'.$v['srl'].'">수정</a>';
									echo '<a href="'.__GOOSE_ROOT__.'nest/remove/'.$v['srl'].'">삭제</a>';
									echo $categoryBtn;
								}
								?>
							</nav>
						</div>
					</div>
				</li>
		<?php
			}
		}
		else
		{
			echo "<li class=\"empty\">데이터가 없습니다.</li>";
		}
		?>
	</ul>
	<!-- // nests list -->

	<!-- buttons -->
	<nav class="nav-btn-group">
		<a href="<?=__GOOSE_ROOT__?>nest/" class="ui-button">목록</a>
		<?php
		if ($this->parent->isAdmin)
		{
		?>
			<a href="<?=__GOOSE_ROOT__?>app/" class="ui-button">APP목록</a>
			<a href="<?=__GOOSE_ROOT__?>nest/create/" class="ui-button col-key">둥지만들기</a>
		<?php
		}
		?>
	</nav>
	<!-- // buttons -->
</section>