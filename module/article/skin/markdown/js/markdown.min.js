jQuery(function(t){var a=document.writeForm,e=new UploadInterface(t("#fileUpload"),{form:a,$manager:t("#queuesManager"),uploadAction:userData.root+"file/upload/",removeAction:userData.root+"file/remove/",fileDir:userData.url,auto:!1,limit:10,thumnail:userData.thumnail,$insertTarget:t("#content"),insertFunc:function(e){for(var n="",r=0;r<e.length;r++)n+=/^image/.test(e[r].type)?"![]("+e[r].url+")\n":"["+e[r].name+"]("+e[r].url+")\n";var o=t(a.content),i=l(o),u=o.val(),s=u.substr(0,i)+n+u.substr(i);o.val(s)}});if(!e.ready)return!1;var n=userData.pushData,r=n?JSON.parse(n):null;r&&e.pushQueue(r),t("#fileUploadButton").on("click",function(){e.upload()}),t(a).on("submit",function(){if(e.thumnailImageCheck())return!1;var t={};userData.articleJSON&&(t=JSON.parse(decodeURIComponent(userData.articleJSON)));var n=e.thumnail.data.coords;t.thumnail={srl:e.thumnail.data.srl,coords:n?n.toString():"",url:e.thumnail.data.url},e.thumnail.data.image&&(a.thumnail_image.value=e.thumnail.data.image),t=encodeURIComponent(JSON.stringify(t)),a.json.value=t});var o=t("div.mk-editor"),i=o.find("a[data-control]");i.on("click",function(){var e=t(this).attr("data-control"),n=o.find("[data-target="+e+"]");if(!t(this).hasClass("active")&&(i.removeClass("active"),t(this).addClass("active"),o.find("[data-target]").removeClass("show"),n.addClass("show"),"preview"==e&&a.content.value)){u(function(t){n.html(t)})}return!1});var u=function(e){var n=t.ajax({url:userData.root+"script/run/markdown_preview/",type:"post",data:{title:"...",nest_srl:a.nest_srl.value,content:a.content.value}});n.done(function(t){e(t)})},l=function(t){var a=t.get(0),e=0;if("selectionStart"in a)e=a.selectionStart;else if("selection"in document){a.focus();var n=document.selection.createRange(),r=document.selection.createRange().text.length;n.moveStart("character",-a.value.length),e=n.text.length-r}return e}});