UploadInterface.prototype.$queue=$('<div class="filesQueue"><ul></ul></div>'),UploadInterface.prototype.controllerButton=function(){var e=this,t='<button type="button" data-action="selectAll" class="gs-button size-small">모두선택</button>';t+='<button type="button" data-action="deleteSelect" class="gs-button size-small">선택삭제</button>',t+='<button type="button" data-action="deleteAll" class="gs-button size-small">모두삭제</button>',this.$controller.append($(t)).children("button").on("click",function(){switch($(this).attr("data-action")){case"selectAll":e.selectAllQueue();break;case"deleteSelect":e.deleteQueue();break;case"deleteAll":e.deleteAllQueue()}})},UploadInterface.prototype.events=function(){var e=this;e.settings.auto&&$el.on("change",function(){e.upload()}),$(window).on("keydown",function(t){(91==t.which||17==t.which)&&(e.key=!0)}),$(window).on("keyup",function(){e.key=!1}),e.$drop&&(e.$drop.on("dragover",!1),e.$drop.on("dragenter",function(e){e.preventDefault(),e.stopPropagation(),$(this).addClass("drag")}),e.$drop.on("dragleave",function(e){e.preventDefault(),e.stopPropagation(),$(this).removeClass("drag")}),e.$drop.on("drop",function(t){t.originalEvent.dataTransfer&&t.originalEvent.dataTransfer.files.length&&(t.preventDefault(),t.stopPropagation(),$(this).removeClass("drag"),e.upload(t.originalEvent.dataTransfer.files))})),e.queue.$index.dragsort({dragSelector:"li",dragSelectorExclude:"span[contenteditable], button",dragBetween:!0,placeHolderTemplate:'<li class="placeHolder"><div></div></li>',dragEnd:function(){}})},UploadInterface.prototype.uploadComplete=function(e,t){var n=this;try{var a=JSON.parse(e)[0];t.state="complete",t.srl=a.srl,t.location=a.loc,t.type="session",t.filename=a.name,t.filetype=a.type,t.element.find(".name").text(t.filename),t.element.find(".size").text(n.bytesToSize(t.filesize)),t.element.find(".state").text(t.state),"complete"==t.state&&t.element.find("div.progress").delay(200).fadeOut(400),/^image/i.test(t.filetype)&&t.element.find("figure").html('<img src="'+n.settings.fileDir+"/"+a.loc+'" alt="" />'),n.resetInput(),n.refreshAddQueue(),n.readyItem.splice(0,1),n.readyItem.length&&n.fileUpload(n.readyItem[0])}catch(l){alert("ERROR UPLOAD"),t.element.remove()}},UploadInterface.prototype.pushQueue=function(e){for(var t=this,n=0;n<e.length;n++){var a=t.queue.createQueue({name:e[n].filename,size:e[n].filesize,type:e[n].filetype,loc:e[n].location,srl:e[n].srl,type2:e[n].type,state:e[n].state,form:e[n].form});t.thumnail.data.srl==e[n].srl&&t.queue.index[a].element.addClass("thumnail")}e.length&&"session"==e[0].type&&t.refreshAddQueue()},UploadInterface.prototype.deleteAllQueue=function(){var e=this;if(confirm("모두 삭제하시겠습니까?")){var t=e.$queue.find("> ul >li");t.length?e.queue.removeQueue(t):alert("업로드 되어있는 파일이 없습니다.")}},UploadInterface.prototype.exportSlideJSON=function(){var e=this,t=[];return e.queue.$index.children().each(function(){var n=$(this).attr("key"),a=e.queue.index[n],l={filename:a.filename,location:a.location,type:"modify",form:[]};$(this).find("div.form > p").each(function(){var e={key:$(this).children("strong").text(),value:$(this).children("span").text()};l.form.push(e)}),t.push(l)}),encodeURIComponent(JSON.stringify(t))},FilesQueue.prototype.$preview=null,FilesQueue.prototype.clearPreview=null,FilesQueue.prototype.template=function(e,t,n,a,l,i){function o(e){var t="";t+='<div class="form">';for(var n=0;n<e.length;n++)t+="<p>",t+="<strong>"+e[n].label+"</strong>",t+='<span contenteditable="true" spellcheck="false" name="'+e[n].name+'">'+e[n].value+"</span>",t+="</p>";return t+="</div>"}var s=this,r='<li key="'+e+'">';return r+="<div>","ready"==n&&(r+='<div class="progress">',r+='<p class="graph"><span></span></p>',r+="</div>"),r+="<figure>",r+=l?'<img src="'+s.parent.settings.fileDir+"/"+l+'" alt="'+t+'" />':"",r+="</figure>",r+='<div class="body">',r+='<p class="title">',r+='<strong class="name">'+t+"</strong>",r+="ready"==n?'<span class="size">0%</span>':"",r+='<span class="state">'+n+"</span>",r+="</p>",r+=i?o(i):"",r+="</div>",r+="<nav>",r+=/^image/i.test(a)?'		<button type="button" data-action="thumnail" class="icn-thumnail" title="썸네일이미지"></button>\n':"",r+='		<button type="button" data-action="delete" class="icn-close" title="삭제"></button>\n',r+="</nav>",r+="</div>",r+="</li>",$(r)},FilesQueue.prototype.queueEventInit=function(e){var t=this;e.on("click",function(){var e=t.getIndexItem($(this).attr("key"));t.selectQueue(e)}),e.find("[contenteditable]").on("click",function(e){e.stopPropagation()}),e.find("nav > button").on("click",function(e){e.stopPropagation();var n=$(this).closest("li");switch($(this).attr("data-action")){case"delete":confirm("파일을 삭제하시겠습니까?")&&t.removeQueue(n);break;case"thumnail":var a=t.parent.queue.index[n.attr("key")];/^image/i.test(a.filetype)&&t.parent.thumnail.open(a)}})},FilesQueue.prototype.createQueue=function(e){var t=this,n=t.count,a="queue-"+n,l=e.state?e.state:"ready",i=t.parent.settings.queueForm;if(i)if(e.form)for(var o=0;o<e.form.length;o++)i[o]&&(i[o].value=e.form[o].value);else for(var o=0;o<i.length;o++)i[o].value="";var s=t.template(a,e.name,l,e.type,/^image/i.test(e.type)?e.loc:null,i);return t.index[a]={filename:e.name,filesize:e.size,filetype:e.type,state:l,element:s,location:e.loc,type:e.type2,srl:e.srl},this.$el.children("ul").append(s),t.queueEventInit(s),t.count++,a},FilesQueue.prototype.selectQueue=function(e){var t=this;e.element.hasClass("on")?(e.element.removeClass("on"),t.clearPreview()):(t.parent.key||t.$index.children().removeClass("on"),e.element.addClass("on"))};