var FilesQueue=function(e,t){var n=this;this.$el=t,this.parent=e,this.$preview=n.$el.children("figure.thumnail"),this.$index=n.$el.children("ul"),this.index={},this.count=0,this.active=[]};FilesQueue.prototype.template=function(e,t,n,i){var s='<li key="'+e+'">\n';return s+='	<div class="body">\n',s+='		<span class="name">'+t+"</span>\n",s+="ready"==n?'		<span class="size">0%</span>\n':"",s+='		<span class="state">'+n+"</span>\n",s+="	</div>\n","ready"==n&&(s+='	<div class="progress">\n',s+='		<p class="graph"><span></span></p>\n',s+="	</div>\n"),s+="	<nav>\n",s+=/^image/i.test(i)?'		<button type="button" data-action="thumnail" class="icn-thumnail" title="썸네일이미지"></button>\n':"",s+='		<button type="button" data-action="insertContent" class="icn-plus" title="본문에 삽입하기"></button>\n',s+='		<button type="button" data-action="delete" class="icn-close" title="삭제"></button>\n',s+="	</nav>\n",s+="</li>",$(s)},FilesQueue.prototype.queueEventInit=function(e){var t=this;e.on("click",function(){var e=t.getIndexItem($(this).attr("key"));t.selectQueue(e)}),e.find("nav > button").on("click",function(e){e.stopPropagation();var n=$(this).closest("li"),i=t.parent.queue.index[n.attr("key")];switch($(this).attr("data-action")){case"delete":confirm("파일을 삭제하시겠습니까?")&&t.removeQueue(n);break;case"thumnail":i&&/^image/i.test(i.filetype)&&t.parent.thumnail.open(i);break;case"insertContent":t.parent.insertContent(n)}})},FilesQueue.prototype.createQueue=function(e){var t=this,n=t.count,i="queue-"+n,s=e.state?e.state:"ready",a=t.template(i,e.name,s,e.type);return t.index[i]={filename:e.name,filesize:e.size,filetype:e.type,state:s,element:a,location:e.loc,type:e.type2,srl:e.srl},this.$el.children("ul").append(a),t.queueEventInit(a),t.count++,i},FilesQueue.prototype.selectQueue=function(e){var t=this;e.element.hasClass("on")?(e.element.removeClass("on"),t.clearPreview()):(t.parent.key||t.$index.children().removeClass("on"),e.element.addClass("on"),/^image/i.test(e.filetype)&&t.$preview.length&&t.$preview.html('<img src="'+t.parent.settings.fileDir+"/"+e.location+'" alt="" />'))},FilesQueue.prototype.selectAllQueue=function(){this.$index.children("li").hasClass("on")?this.$index.children("li").removeClass("on"):this.$index.children("li").addClass("on")},FilesQueue.prototype.removeQueue=function(e){var t=this,n=t.parent.settings.removeAction,i=[];if(e.each(function(){var e=t.getIndexItem($(this).attr("key"));i.push({table:"session"==e.type?"file_tmp":"file",srl:parseInt(e.srl)})}),n){var s=$.ajax({url:n,type:"post",dataType:"json",data:{data:JSON.stringify(i),sess_id:userData.sess_id?userData.sess_id:""}});s.fail(function(e){log("AJAX ERROR"),e.error&&e.error(e.stateText)}).done(function(n){"success"==n.state?(e.each(function(){delete t.index[$(this).attr("key")]}),e.fadeOut(400,function(){$(this).remove()}),t.parent.refreshAddQueue()):log(n)})}},FilesQueue.prototype.clearPreview=function(){this.$preview.html("")},FilesQueue.prototype.getIndexItem=function(e){return this.index[e]},FilesQueue.prototype.getItems=function(){var e=this;return e.$index.children("li.on").map(function(t){return e.index[$(this).attr("key")]})},FilesQueue.prototype.getItem=function(e){var t=this.$index.children("li."+e);return t.length?this.index[t.eq(0).attr("key")]:null},FilesQueue.prototype.updateThumnailClass=function(e){this.$index.children("li.thumnail").removeClass("thumnail"),e.addClass("thumnail")};